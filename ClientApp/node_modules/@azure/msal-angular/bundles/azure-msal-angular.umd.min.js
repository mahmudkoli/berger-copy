!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("msal"),require("@angular/router"),require("msal/lib-commonjs/utils/UrlUtils"),require("@angular/common"),require("msal/lib-commonjs/utils/WindowUtils"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("@azure/msal-angular",["exports","@angular/core","rxjs","rxjs/operators","msal","@angular/router","msal/lib-commonjs/utils/UrlUtils","@angular/common","msal/lib-commonjs/utils/WindowUtils","@angular/common/http"],t):t(((e=e||self).azure=e.azure||{},e.azure["msal-angular"]={}),e.ng.core,e.rxjs,e.rxjs.operators,e.msal,e.ng.router,e.UrlUtils,e.ng.common,e.WindowUtils,e.ng.common.http)}(this,(function(e,t,r,o,n,i,a,s,c,u){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var p=function(){return(p=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function f(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function h(e,t){return function(r,o){t(r,o,e)}}function g(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))}function d(e,t){var r,o,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var m=function(){function e(){this._msalSubject=new r.BehaviorSubject(1),this.msalItem$=this._msalSubject.asObservable()}return e.prototype.broadcast=function(e,t){this._msalSubject.next({type:e,payload:t})},e.prototype.getMSALSubject=function(){return this._msalSubject},e.prototype.getMSALItem=function(){return this.msalItem$},e.prototype.subscribe=function(e,t){return this.msalItem$.pipe(o.filter((function(t){return t.type===e})),o.map((function(e){return e.payload}))).subscribe(t)},e=f([t.Injectable()],e)}(),y=function(){function e(e,t,r){this._error="",this._errorDesc="",this._scopes="",this._error=e,t&&(this._errorDesc=t),r&&(this._scopes=r)}return Object.defineProperty(e.prototype,"error",{get:function(){return this._error},set:function(e){this._error=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"errorDesc",{get:function(){return this._errorDesc},set:function(e){this._errorDesc=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scopes",{get:function(){return this._scopes},set:function(e){this._scopes=e},enumerable:!0,configurable:!0}),e}(),b=new t.InjectionToken("MSAL_CONFIG"),v=new t.InjectionToken("MSAL_CONFIG_ANGULAR"),S=function(e){return p(p({},e),{framework:p(p({},e.framework),{isAngular:!0})})},w=function(e){function r(t,r,o,n){var i=e.call(this,S(t))||this;return i.msalConfig=t,i.msalAngularConfig=r,i.router=o,i.broadcastService=n,window.addEventListener("msal:popUpHashChanged",(function(e){i.getLogger().verbose("popUpHashChanged ")})),window.addEventListener("msal:popUpClosed",(function(e){var t=e.detail.split("|"),r=new y(t[0],t[1]);i.getLoginInProgress()?(n.broadcast("msal:loginFailure",r),i.setloginInProgress(!1)):i.getAcquireTokenInProgress()&&(n.broadcast("msal:acquireTokenFailure",r),i.setAcquireTokenInProgress(!1))})),i.router.events.subscribe((function(e){for(var t=0;t<o.config.length;t++)o.config[t].canActivate||i.msalAngularConfig.unprotectedResources&&(i.isEmpty(o.config[t].path)||i.isUnprotectedResource(o.config[t].path)||i.msalAngularConfig.unprotectedResources.push(o.config[t].path))})),i}return function(e,t){function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(r,e),r.prototype.isUnprotectedResource=function(e){var t=this.msalConfig.framework&&this.msalConfig.framework.unprotectedResources,r=this.msalAngularConfig.unprotectedResources||[];return(t&&t.length?t:r).some((function(t){return e.indexOf(t)>-1}))},r.prototype.isEmpty=function(e){return void 0===e||!e||0===e.length},r.prototype.getCacheStorage=function(){return this.cacheStorage},r.prototype.loginPopup=function(t){var r=this;return e.prototype.loginPopup.call(this,t).then((function(e){return r.broadcastService.broadcast("msal:loginSuccess",e),e})).catch((function(e){throw r.broadcastService.broadcast("msal:loginFailure",e),r.getLogger().error("Error during login:\n"+e.errorMessage),e}))},r.prototype.acquireTokenSilent=function(t){var r=this;return e.prototype.acquireTokenSilent.call(this,t).then((function(e){return r.broadcastService.broadcast("msal:acquireTokenSuccess",e),e})).catch((function(e){throw r.broadcastService.broadcast("msal:acquireTokenFailure",e),r.getLogger().error("Error when acquiring token for scopes: "+t.scopes+" "+e),e}))},r.prototype.acquireTokenPopup=function(t){var r=this;return e.prototype.acquireTokenPopup.call(this,t).then((function(e){return r.broadcastService.broadcast("msal:acquireTokenSuccess",e),e})).catch((function(e){throw r.broadcastService.broadcast("msal:acquireTokenFailure",e),r.getLogger().error("Error when acquiring token for scopes : "+t.scopes+" "+e),e}))},r.prototype.handleRedirectCallback=function(t,r){var o=this;e.prototype.handleRedirectCallback.call(this,(function(e,n){n?("id_token"===n.tokenType?o.broadcastService.broadcast("msal:loginSuccess",n):o.broadcastService.broadcast("msal:acquireTokenSuccess",n),r?t(n):t(null,n)):e&&("id_token"===n.tokenType?o.broadcastService.broadcast("msal:loginFailure",e):o.broadcastService.broadcast("msal:acquireTokenFailure",e),r?r(e,n.accountState):t(e))}))},r.prototype.clearCacheForScope=function(t){return e.prototype.clearCacheForScope.call(this,t)},r.prototype.getScopesForEndpoint=function(t){if(this.msalConfig.framework&&this.msalConfig.framework.unprotectedResources&&this.getLogger().info("msalConfig.framework.unprotectedResources is deprecated, use msalAngularConfig.unprotectedResources"),this.isUnprotectedResource(t))return null;var r=this.msalConfig.framework&&this.msalConfig.framework.protectedResourceMap;r&&this.getLogger().info("msalConfig.framework.protectedResourceMap is deprecated, use msalAngularConfig.protectedResourceMap");var o=r&&r.size?r:new Map(this.msalAngularConfig.protectedResourceMap),n=Array.from(o.keys()).find((function(e){return t.indexOf(e)>-1}));return n?o.get(n):t.indexOf("http://")>-1||t.indexOf("https://")>-1?a.UrlUtils.getHostFromUri(t)===a.UrlUtils.getHostFromUri(e.prototype.getRedirectUri.call(this))?new Array(this.msalConfig.auth.clientId):null:new Array(this.msalConfig.auth.clientId)},r.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[b]}]},{type:void 0,decorators:[{type:t.Inject,args:[v]}]},{type:i.Router},{type:m}]},r=f([t.Injectable(),h(0,t.Inject(b)),h(1,t.Inject(v))],r)}(n.UserAgentApplication),j=function(){function e(e,t,r,o,n,i,a,s){this.msalConfig=e,this.msalAngularConfig=t,this.authService=r,this.router=o,this.activatedRoute=n,this.location=i,this.platformLocation=a,this.broadcastService=s}return e.prototype.getDestinationUrl=function(e){var t=document.getElementsByTagName("base"),r=this.location.normalize(t.length?t[0].href:window.location.origin),o=this.location.prepareExternalUrl(e);return o.startsWith("#")?r+"/"+o:""+r+e},e.prototype.loginInteractively=function(e){return g(this,void 0,void 0,(function(){var t;return d(this,(function(r){return this.msalAngularConfig.popUp?[2,this.authService.loginPopup({scopes:this.msalAngularConfig.consentScopes,extraQueryParameters:this.msalAngularConfig.extraQueryParameters}).then((function(){return!0})).catch((function(){return!1}))]:(t=this.getDestinationUrl(e),this.authService.loginRedirect({redirectStartPage:t,scopes:this.msalAngularConfig.consentScopes,extraQueryParameters:this.msalAngularConfig.extraQueryParameters}),[2])}))}))},e.prototype.canActivate=function(e,t){var r=this;return this.authService.getLogger().verbose("location change event from old url to new url"),a.UrlUtils.urlContainsHash(window.location.hash)&&c.WindowUtils.isInIframe()?(this.authService.getLogger().warning("redirectUri set to page with MSAL Guard. It is recommended to not set redirectUri to a page that requires authentication."),!1):this.authService.getAccount()?this.authService.acquireTokenSilent({scopes:[this.msalConfig.auth.clientId]}).then((function(){return!0})).catch((function(e){if(n.InteractionRequiredAuthError.isInteractionRequiredError(e.errorCode))return r.authService.getLogger().info("Interaction required error in MSAL Guard, prompting for interaction."),r.loginInteractively(t.url);throw r.authService.getLogger().error("Non-interaction error in MSAL Guard: "+e.errorMessage),e})):this.loginInteractively(t.url)},e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[b]}]},{type:void 0,decorators:[{type:t.Inject,args:[v]}]},{type:w},{type:i.Router},{type:i.ActivatedRoute},{type:s.Location},{type:s.PlatformLocation},{type:m}]},e=f([t.Injectable(),h(0,t.Inject(b)),h(1,t.Inject(v))],e)}(),k=function(){function e(e,t){this.auth=e,this.broadcastService=t}return e.prototype.intercept=function(e,t){var n,i=this,a=this.auth.getScopesForEndpoint(e.url);return this.auth.getLogger().verbose("Url: "+e.url+" maps to scopes: "+a),a?r.from(this.auth.acquireTokenSilent({scopes:a}).then((function(t){n=t.accessToken;var r="Bearer "+t.accessToken;return e.clone({setHeaders:{Authorization:r}})}))).pipe(o.mergeMap((function(e){return t.handle(e)})),o.tap((function(e){}),(function(e){e instanceof u.HttpErrorResponse&&401===e.status&&(i.auth.clearCacheForScope(n),i.broadcastService.broadcast("msal:notAuthorized",e.message))}))):t.handle(e)},e.ctorParameters=function(){return[{type:w},{type:m}]},e=f([t.Injectable()],e)}(),A={consentScopes:[],popUp:!1,extraQueryParameters:{},unprotectedResources:[],protectedResourceMap:[]},C=function(){function e(){}var r;return r=e,e.forRoot=function(e,t){return void 0===t&&(t=A),{ngModule:r,providers:[{provide:b,useValue:e},{provide:v,useValue:t},w]}},e=r=f([t.NgModule({imports:[s.CommonModule],declarations:[],providers:[j,m]})],e)}();e.BroadcastService=m,e.MSAL_CONFIG=b,e.MSAL_CONFIG_ANGULAR=v,e.MsalGuard=j,e.MsalInterceptor=k,e.MsalModule=C,e.MsalService=w,e.ɵa=A,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=azure-msal-angular.umd.min.js.map